
<!DOCTYPE html> 
<!--
	Noam's theme, based on Readnik scriptogr.am theme
-->
<html lang="en">
<head>
  <title>Noam Ross | Dave Harris on Maximum Likelihood Estimation</title>
  <meta name="description" content=" " />
  <meta name="author" content="Noam Ross">
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="ROBOTS" content="INDEX,FOLLOW">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <meta property="og:url" content="">
  <meta property="og:site_name" content="Noam Ross">
  <link rel="icon" type="image/x-icon" href="/assets/themes/noamblog/atom.ico">
  <link href="/assets/themes/noamblog/css/style.css" rel="stylesheet" type="text/css" media="all">
  <link href="http://feeds.feedburner.com/noamross" rel="alternate" type="application/rss+xml" title="Noam Ross" />
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30394461-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
 </script>
 <script type="text/javascript"> 
    function typeset() {
      MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
    function disqus_config() {
      this.callbacks.onNewComment = [typeset];
      this.callbacks.onInit = [typeset];
    }
  </script>
  <script src="http://cachedcommons.org/javascripts/text/prettify-min.js" type="text/javascript"></script>
  <script src="http://cachedcommons.org/javascripts/text/showdown-min.js" type="text/javascript"></script>
  <script src="http://cachedcommons.org/javascripts/jquery/jquery.disqus.js" type="text/javascript"></script>
  <script type="text/javascript" src="/assets/themes/noamblog/app.js"></script>  
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
  <script type="text/x-mathjax-config">  MathJax.Hub.Config({ "HTML-CSS": { availableFonts: ["TeX"], webfont: [null] }} ); </script>
  <script type="text/x-mathjax-config">  MathJax.Hub.Config({ TeX: { extensions: ["autobold.js"] }} ); </script>
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "4376beef-ffcc-441e-a877-904acf7f379b", theme:'8', onhover:false, doNotHash:true, doNotCopy:true, hashAddressBar:false}); </script>
  <script type="text/javascript">
      function chgifr(url, iframe)  {
          document.getElementById(iframe).src = url;
      }
  </script>
  <script type="text/javascript">
      function showhide(id) {
           var e = document.getElementById(id);
           if(e.style.display == 'block')
              e.style.display = 'none';
           else
              e.style.display = 'block';
        }
  </script>
</head>
<body>
<div class="wrapper">
  <div class="blog">
 
      <div id="menu" class="menu-top">
        <div class="blog-info">
          <h1><a href="/index.html">Noam Ross</a></h1>
          <div class="blog-description">
           <h2>Real-time research in ecology, economics, and sustainability</h2>
          </div>
         </div>
          <div class="pages">
            
            <!-- Lockerz Share BEGIN -->
            <a class="a2a_dd" href="http://www.addtoany.com/share_save" tile"Share this Page"><span class="shareicon"><span class="hide">Share</span></span></a>
            <script type="text/javascript">
            var a2a_config = a2a_config || {};
            a2a_config.onclick = 0;
            a2a_config.show_title = 1;
            a2a_config.color_main = "FFFFFF";
            a2a_config.color_border = "FFFFFF";
            a2a_config.color_link_text = "45462f";
            a2a_config.color_link_text_hover = "575757";
            a2a_config.prioritize = ["twitter", "facebook", "tumblr", "email", "delicious", "linkedin", "stumbleupon", "google_plus"];
            </script>
            <script type="text/javascript" src="http://static.addtoany.com/menu/page.js"></script>
            <!-- Lockerz Share END -->
            
            <a href="http://feeds.feedburner.com/noamross" title="Subscribe via Feedburner RSS"> <span class="rssicon"> <span class="hide">RSS</span></span></a>
            
             
             
            


  
    
  
    
    	
    	<a href="/about.html">About</a>
    	
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
    	
    	<a href="/connect.html">Connect</a>
    	
    
  
    
  
    
    	
    	<a href="/index.html">Blog</a>
    	
    
  
    
  
    
  
    
    	
    	<a href="/publications.html">Publications</a>
    	
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
    	
    	<a href="/tags.html">Topics</a>
    	
    
  
    
  



            
        </div>
      </div>

      <div class="container">

        <div class="content">
          
<div id="headblock">
<h1 id="page.title"><a href="/blog/2013/6/17/harrisbbmle.html">Dave Harris on Maximum Likelihood Estimation</a></h1>
<p>by <em>Noam Ross</em>, 17 June 2013</p>
<hr />
</div>
<div class="contenttext"><p><p><em>At our last <a href="http://www.noamross.net/davis-r-users-group.html">Davis R Users’ Group</a> meeting of the quarter, <a href="https://sihlab.wordpress.com/david-j-harris/">Dave Harris</a> gave a talk on how to use the <code>bbmle</code> package to fit mechanistic models to ecological data. Here’s his script, which I ran throgh the <code>spin</code> function in <code>knitr</code>:</em></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load data</span>
<span class="kw">library</span>(emdbook)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Loading required package: MASS Loading required package: lattice</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bbmle)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Loading required package: stats4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ReedfrogFuncresp)
<span class="kw">plot</span>(ReedfrogFuncresp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>)</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h1.png" />
</div>
<p>Statistical models are stories about how the data came to be. The deterministic part of the story is a (slightly mangled) version of what you’d expect if the predators followed a Type II functional response:</p>
<p>Holling’s Disk equation for Type II Functional Response</p>
<ul>
<li><code>a</code> is attack rate</li>
<li><code>h</code> is handling time</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">disk =<span class="st"> </span>function(N, a, h) {
    N *<span class="st"> </span>a/(<span class="dv">1</span> +<span class="st"> </span>N *<span class="st"> </span>a *<span class="st"> </span>h)
}</code></pre>
<p>We can plot different values of <code>a</code> and <code>h</code> to see what kinds of data this model would generate <em>on average:</em></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ReedfrogFuncresp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>)
<span class="co"># a = 3, h = 0.05 (black) rises too quickly, saturates too quickly</span>
<span class="kw">curve</span>(<span class="kw">disk</span>(x, <span class="dt">a =</span> <span class="dv">3</span>, <span class="dt">h =</span> <span class="fl">0.05</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">100</span>)
<span class="co"># a = 2, h = 0.02 (red) still rises too quickly</span>
<span class="kw">curve</span>(<span class="kw">disk</span>(x, <span class="dv">2</span>, <span class="fl">0.02</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">100</span>, <span class="dt">col =</span> <span class="dv">2</span>)
<span class="co"># a = 0.5, h = 0.02 (blue) looks like a plausible data-generating process</span>
<span class="kw">curve</span>(<span class="kw">disk</span>(x, <span class="fl">0.5</span>, <span class="fl">0.02</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">100</span>, <span class="dt">col =</span> <span class="dv">4</span>)</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h3.png" />
</div>
<p>The blue curve looks plausible, but is it optimal? Does it tell the best possible story about how the data could have been generated?</p>
<p>In order to tell if it’s optimal, we need to pick something to optimize. Usually, that will be the log-likelihood–i.e. the log-probability that the data would have come out this way if the model were true. Models with higher probabilities of generating the data we observed therefore have higher likelihoods. For various arbitrary reasons, it’s common to minimize the negative log-likelihood rather than maximizing the positive log-likelihood. So let’s write a function that says what the log-likelihood is for a given pair of <code>a</code> and <code>h</code>.</p>
<p>The log-likelihood is the sum of log-probabilities from each data point. The log-probability for a data point is (in this contrived example) drawn from a binomial (“coin flip”) distribution, whose mean is determined by the disk equation.</p>
<pre class="sourceCode r"><code class="sourceCode r">NLL =<span class="st"> </span>function(a, h) {
    -<span class="kw">sum</span>(<span class="kw">dbinom</span>(ReedfrogFuncresp$Killed, <span class="dt">size =</span> ReedfrogFuncresp$Initial, <span class="dt">prob =</span> <span class="kw">disk</span>(ReedfrogFuncresp$Initial, 
        a, h)/ReedfrogFuncresp$Initial, <span class="dt">log =</span> <span class="ot">TRUE</span>))
}</code></pre>
<p>We can optimize the model with the mle2 function. It finds the lowest value for the negative log-likelihood (i.e. the combination of parameters with the highest positive likelihood, or the maximum likelihood estimate).</p>
<p>The NLL function we defined above requires starting values for <code>a</code> and <code>h</code>. Let’s naively start them at 1, 1</p>
<pre class="sourceCode r"><code class="sourceCode r">fit =<span class="st"> </span><span class="kw">mle2</span>(NLL, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">h =</span> <span class="dv">1</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced</code></pre>
<p>You’ll probably get lots of warnings about NaNs. That’s just the optimization procedure complaining because it occasionally tries something impossible (such as a set of parameters that would generate a negative probability of being eaten). In general, these warnings are nothing to worry about, since the optimization procedure will just try better values. But it’s worth checking to make sure that there are no other warnings or problems by calling <code>warnings()</code> after you fit the model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print out the results</span>
fit</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 
## Call:
## mle2(minuslogl = NLL, start = list(a = 1, h = 1))
## 
## Coefficients:
##       a       h 
## 0.52652 0.01666 
## 
## Log-likelihood: -46.72</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># a bit more information:</span>
<span class="kw">summary</span>(fit)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Maximum likelihood estimation
## 
## Call:
## mle2(minuslogl = NLL, start = list(a = 1, h = 1))
## 
## Coefficients:
##   Estimate Std. Error z value   Pr(z)    
## a  0.52652    0.07112    7.40 1.3e-13 ***
## h  0.01666    0.00488    3.41 0.00065 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## -2 log L: 93.44</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(fit)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##       a       h 
## 0.52652 0.01666</code></pre>
<p>Here’s the curve associated with the most likely combination of a and <code>h</code> (thick black line).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ReedfrogFuncresp, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>)
<span class="kw">curve</span>(<span class="kw">disk</span>(x, <span class="dt">a =</span> <span class="kw">coef</span>(fit)[<span class="st">&quot;a&quot;</span>], <span class="dt">h =</span> <span class="kw">coef</span>(fit)[<span class="st">&quot;h&quot;</span>]), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="dv">4</span>, 
    <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">100</span>)</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h7.png" />
</div>
<p>The rethinking package has a few convenient functions for summarizing and visualizing the output of an mle2 object. It’s not on CRAN, but you can get it from the author’s website or <a href="https://github.com/rmcelreath/rethinking">from github.</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Attaching package: &#39;rethinking&#39;
## 
## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
## x</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">precis</span>(fit)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##   Estimate S.E. 2.5% 97.5%
## a     0.53 0.07 0.39  0.67
## h     0.02 0.00 0.01  0.03</code></pre>
<p>We can also visualize a distribution of estimates that are reasonably consistent with the observed data using the sample.naive.posterior function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">sample.naive.posterior</span>(fit), <span class="dt">pch =</span> <span class="st">&quot;.&quot;</span>)

<span class="co"># Add a red dot for the maximum likelihood estimate:</span>
<span class="kw">points</span>(<span class="kw">as.data.frame</span>(<span class="kw">as.list</span>(<span class="kw">coef</span>(fit))), <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">pch =</span> <span class="dv">20</span>)

<span class="co"># Add a blue dot for our earlier guess:</span>
<span class="kw">points</span>(<span class="fl">0.5</span>, <span class="fl">0.02</span>, <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">pch =</span> <span class="dv">20</span>)</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h9.png" />
</div>
<hr />
<h3 id="a-big-digression-about-confidence-intervals">A Big digression about confidence intervals</h3>
<p>Our earlier guess falls inside the cloud of points, so even though it’s not as good as the red point, it’s still plausibly consistent with the data.</p>
<p>Note that the ranges of plausible estimates for the two coefficients are correlated: This makes sense if you think about it: if the attack rate is high, then there needs to be a large handling time between attacks or else too many frogs would get eaten.</p>
<p>Where did this distribution of points come from? <code>mle2</code> objects, like many models in R, have a variance/covariance matrix that can be extracted with the vcov() function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vcov</span>(fit)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##           a         h
## a 0.0050584 2.859e-04
## h 0.0002859 2.384e-05</code></pre>
<p>The variance terms (along the diagonal) describe mle2’s uncertainty about the values. The covariance terms (other entries in the matrix) describe how uncertainty in one coefficient relates to uncertainty in the other coefficient.</p>
<p>This graph gives an example:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">curve</span>(<span class="kw">dnorm</span>(x, <span class="dt">sd =</span> <span class="dv">1</span>/<span class="dv">2</span>), <span class="dt">from =</span> -<span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">5</span>, <span class="dt">ylab =</span> <span class="st">&quot;likelihood&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;estimate&quot;</span>)
<span class="kw">curve</span>(<span class="kw">dnorm</span>(x, <span class="dt">sd =</span> <span class="dv">3</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="dv">2</span>)</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h11.png" />
</div>
<p>The black curve shows a model with low variance for its estimate. This means that the likelihood would fall off quickly if we tried a bad estimate, and we can be reasonably sure that the data was generated by a value in a fairly narrow range. The model associated with the red curve is much less certain: the parameter could be very different from the optimal value and the likelihood wouldn’t drop much.</p>
<p>Here’s another way to visualize the decline in likelihood as you move away from the best estimate:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">profile</span>(fit))</code></pre>
<div class="figure">
<img src="http://dl.dropbox.com/u/3356641/blogstuff/h12.png" />
</div>
<p>Keep in mind that all of this is based on a Gaussian approximation. It works well when you have lots of data and you aren’t estimating something near a boundary. Since <code>h</code> is near its minimum value (at zero), there’s some risk that the confidence intervals are inaccurate. Markov chain Monte Carlo can provide more accurate estimates, but it’s also slower to run.</p>
<h4 id="a-somewhat-related-digression">A somewhat-related digression:</h4>
<p>Where does the vcov matrix come from? From a matrix called the Hessian. It describes the curvature of the likelihood surface, i.e. how quickly the log-likelihood falls off as you move away from the optimum.</p>
<p>Sometimes the Hessian is hard to estimate and causes problems, so we can run the model without it:</p>
<pre class="sourceCode r"><code class="sourceCode r">fit.without.hessian =<span class="st"> </span><span class="kw">mle2</span>(NLL, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">h =</span> <span class="dv">1</span>), <span class="dt">skip.hessian =</span> <span class="ot">TRUE</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced</code></pre>
<p>When there’s no Hessian, there aren’t any confidence intervals, though.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">precis</span>(fit.without.hessian)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##   Estimate S.E. 2.5% 97.5%
## a     0.53   NA   NA    NA
## h     0.02   NA   NA    NA</code></pre>
<p>(End digression)</p>
<hr />
<h3 id="more-about-mle2">More about <code>mle2</code></h3>
<p>Under the hood, <code>mle2</code> uses a function called optim:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="st">`</span><span class="dt">?</span><span class="st">`</span>(optim)</code></pre>
<p>It’s worth noting that most of the optimization methods used in optim (and therefore in <code>mle2</code>) only do a local optimization. So if your likelihood surface has multiple peaks, you may not find the right one.</p>
<p><code>mle2</code> also has a convenient formula inferface that can eliminate the need to write a whole likelihood function from scratch. Let’s take a look with some data found in ?mle2</p>
<pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">0</span>:<span class="dv">10</span>
y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">26</span>, <span class="dv">17</span>, <span class="dv">13</span>, <span class="dv">12</span>, <span class="dv">20</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">8</span>)
d =<span class="st"> </span><span class="kw">data.frame</span>(x, y)</code></pre>
<p>Here, we’re fitting a Poisson model that depends on an intercept term plus a linear term. The <code>exp()</code> is mainly there to make sure that the value of lambda doesn’t go negative, which isn’t allowed (it would imply a negative number of occurrences for our outcome of interest).</p>
<pre class="sourceCode r"><code class="sourceCode r">fit0 =<span class="st"> </span><span class="kw">mle2</span>(y ~<span class="st"> </span><span class="kw">dpois</span>(<span class="dt">lambda =</span> <span class="kw">exp</span>(intercept +<span class="st"> </span>slope *<span class="st"> </span>x)), <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">intercept =</span> <span class="kw">mean</span>(y), 
    <span class="dt">slope =</span> <span class="dv">0</span>), <span class="dt">data =</span> d)</code></pre>
<p>Note that mle2 finds its values for x and y from the <code>data</code> term and that we’re giving it starting values for the slope and intercept. In general, it’s useful to start the intercept at the mean value of y and the slope terms at 0, but it often won’t matter much.</p>
<h3 id="prior-information">Prior information</h3>
<p>Recall that our estimates of a and <code>h</code> are positively correlated: the data could be consistent with either a high attack rate and a high handling time OR with a low attack rate and a low handling time.</p>
<p>Suppose we have prior information about tadpole/dragonfly biology that suggests that these parameters should be on the low end. We can encode this prior information as a prior distribution on the parameters. Then mle2 won’t climb the likelihood surface. It will climb the surface of the Bayesian posterior (or if you’re frequentist, it will do a penalized or constrained optimization of the likelihood).</p>
<p>Here’s a negative log posterior that tries to keep the values of <code>a</code> and <code>h</code> small while still being consistent with the data:</p>
<pre class="sourceCode r"><code class="sourceCode r">negative.log.posterior =<span class="st"> </span>function(a, h) {
    <span class="kw">NLL</span>(a, h) -<span class="st"> </span><span class="kw">dexp</span>(a, <span class="dt">rate =</span> <span class="dv">10</span>, <span class="dt">log =</span> <span class="ot">TRUE</span>) -<span class="st"> </span><span class="kw">dexp</span>(h, <span class="dt">rate =</span> <span class="dv">10</span>, <span class="dt">log =</span> <span class="ot">TRUE</span>)
}</code></pre>
<p>We optimize it exactly as before</p>
<pre class="sourceCode r"><code class="sourceCode r">fit2 =<span class="st"> </span><span class="kw">mle2</span>(negative.log.posterior, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">h =</span> <span class="dv">1</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced Warning: NaNs produced Warning: NaNs produced
## Warning: NaNs produced</code></pre>
<p>Sure enough, the coefficients are a bit smaller</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(fit)  <span class="co"># MLE</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##       a       h 
## 0.52652 0.01666</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(fit2)  <span class="co"># MAP estimate</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##       a       h 
## 0.47931 0.01375</code></pre></p></div>
<ul class="tags">
  
    <li><strong>Tags: </strong></li>
    
    <li><a href="/tags.html#R-ref">R</a></li>
    
    <li><a href="/tags.html#D-RUG-ref">D-RUG</a></li>
    
    <li><a href="/tags.html#optimization-ref">optimization</a></li>
      
</ul>



  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'noamrossgh'; // required: replace example with your forum shortname
    var disqus_identifier = '/blog/2013/6/17/harrisbbmle.html';
    var disqus_url = 'http://www.noamross.net/blog/2013/6/17/harrisbbmle.html';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





<div class="noprint"><hr />
<p> <strong>Previous Post</strong>: <em><a href="/blog/2013/6/12/multi-infection-overdispersed.html">The null model for age effects with overdispersed infection</a></em> </p>
<p> <strong>Next Post</strong>: <em><a href="/blog/2013/6/17/harrisbbmle.html">Dave Harris on Maximum Likelihood Estimation</a></em> </p></div>



        </div>
    

      </div>
      
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script type="text/javascript" src="/assets/themes/noamblog/footnote-links.js"></script>
<script type="text/javascript">$('div.contenttext').footnoteLinks();</script>
</body>
</html>
